import Preview from "../../components/Preview";
import {PropsTable} from "../../components/table/option-table";
import {DataGridClientFilteringExample} from "../../components/examples/datagrid-client-filtering-example";
import {Tab, Tabs} from "nextra/components";

## Filtering

Enable filtering on specific columns using the `withFiltering` and `getFilterFn` helpers.

<Tabs items={['Helper', 'API']}>
    <Tab></Tab>
    <Tab>
        <PropsTable title="withFiltering" options={[
            ["type", "T extends DataGridFilteringType", `"select" | "radio" | "checkbox" | "boolean" | "date-range"`],
            ["name", "string"],
            ["icon?", "React.ReactElement"],
            ["options?", "Array\<{ value: string, label?: T extends \"select\" ? string : React.ReactNode }\>"],
            ["valueFormatter?", "(value: any) => any", "Format the value displayed in the filter pill."]
        ]}/>

        <PropsTable title="getFilterFn" options={[
            ["(type)", "DataGridFilteringType", `"select" | "radio" | "checkbox" | "boolean" | "date-range"`],
        ]}/>
    </Tab>
</Tabs>

### Filter types

These are the pre-built filters

- select
- radio
- checkbox
- boolean
- date-range
- number üèóÔ∏è

### Client-side

#### Example

<Preview contentClassName={"max-w-full"}>
    <DataGridClientFilteringExample/>
</Preview>

```tsx showLineNumbers /withFiltering/ /getFilterFn/
import React from "react"
import { createDataGridColumns } from "@/components/ui/datagrid"

export function Demo() {

    const columns = useMemo(() => createDataGridColumns<Product>(({ withValueFormatter, withFiltering, getFilterFn }) => [
        ...
        {
            accessorKey: "category",
            header: "Category",
            cell: info => info.getValue(),
            size: 20,
            filterFn: getFilterFn("radio"),
            meta: {
                ...withFiltering({
                    name: "Category",
                    type: "radio",
                    options: [{ value: "Electronics" }, { value: "Food" }],
                    icon: <BiFolder/>,
                }),
            },
        },
        {
            accessorKey: "availability",
            header: "Availability",
            cell: info => info.getValue(),
            size: 20,
            filterFn: getFilterFn("checkbox"),
            meta: {
                ...withValueFormatter<string>(value => {
                    if (value === "out_of_stock") return "Out of stock"
                    if (value === "in_stock") return "In stock"
                    return value
                }),
                ...withFiltering({
                    name: "Availability",
                    type: "checkbox",
                    icon: <BiCheck/>,
                    options: [
                        {
                            value: "out_of_stock",
                            label: <span className={"flex items-center gap-2"}><BiBasket className={"text-red-500"}/><span>Out of stock</span></span>,
                        },
                        {
                            value: "in_stock",
                            label: <span className={"flex items-center gap-2"}><BiBasket className={"text-green-500"}/><span>In stock</span></span>,
                        },
                    ],
                }),
            },
        },
        {
            accessorKey: "visible",
            header: "Visible",
            cell: info => <Badge intent={info.getValue() === "Visible" ? "success" : "gray"}>{info.getValue<string>()}</Badge>,
            size: 20,
            filterFn: getFilterFn("boolean"),
            meta: {
                ...withValueFormatter<boolean, string>(value => {
                    return value ? "Visible" : "Hidden"
                }),
                ...withFiltering({
                    name: "Visible",
                    type: "boolean",
                    icon: <BiLowVision/>,
                    valueFormatter: (value) => {        // Overrides `withValueFormatter`
                        return value ? "Yes" : "No"
                    },
                }),
            },
        },
        ...
    ]), [])

    return (...)

}
```

### Disable filtering

```tsx showLineNumbers /enableColumnFilters={false}/ /enableGlobalFilter={false}/
function Demo() {
    return (
        <DataGrid<Product>
            {...props}
            enableColumnFilters={false}
            enableGlobalFilter={false}
        />
    )
}
```

### Server-side/Manual

Filtering can be done server-side by setting `enableManualFiltering` to `true`.

- `enableManualFiltering` will disable client-side filtering and let you control it manually

```tsx showLineNumbers {5-6,30,32-38}
import { createDataGridColumns, DataGrid } from "@/components/ui/datagrid"
import { ColumnFiltersState } from "@tanstack/react-table"

function Demo() {
    const [globalFilter, setGlobalFilter] = useState<string>("")
    const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([])

    const { data, isLoading, isFetching } = useFakeQuery({
        queryKey: [
            "table-data",
            globalFilter, // Refetch when data changes
            columnFilters, // Refetch when data changes
        ],
        queryFn: async () => {
            const fetchURL = new URL("/api/data", "http://localhost:3000")
            fetchURL.searchParams.set("search", globalFilter)
            fetchURL.searchParams.set("filters", JSON.stringify(columnFilters))
            const res = await fetch(fetchURL.href)
            return (await res.json())
        },
        keepPreviousData: true,
    })

    const columns = useMemo(() => createDataGridColumns<Product>(() => [...]))

    return (
        <DataGrid<Product>
            data={data}
            columns={columns}
            rowCount={data?.meta?.totalRowCount ?? 0}
            isLoading={isLoading}
            state={{
                globalFilter,
                columnFilters,
            }}
            onGlobalFilterChange={setGlobalFilter}
            onColumnFiltersChange={setColumnFilters}
            enableManualFiltering={true}
            isDataMutating={isFetching}
        />
    )

}
```
