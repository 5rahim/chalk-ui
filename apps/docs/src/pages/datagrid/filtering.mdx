import Preview from "../../components/Preview";
import { PropsTable } from "../../components/table/option-table";
import { DataGridClientFilteringExample } from "../../components/examples/datagrid-client-filtering-example";
import { Tab, Tabs } from "nextra/components";

## Filtering

Enable filtering on specific columns using the `withFiltering` and `getFilterFn` helpers.

<Tabs items={['Helper', 'API']}>
    <Tab></Tab>
    <Tab>
        <PropsTable title="withFiltering" options={[
            ["type", "T extends DataGridFilteringType", `"select" | "radio" | "checkbox" | "boolean" | "date-range"`],
            ["name", "string"],
            ["icon?", "React.ReactElement"],
            ["options?", "Array\<{ value: string, label?: T extends \"select\" ? string : React.ReactNode }\>"],
            ["valueFormatter?", "(value: any) => any", "Format the value displayed in the filter pill."]
        ]}/>

        <PropsTable title="getFilterFn" options={[
            ["(type)", "DataGridFilteringType", `"select" | "radio" | "checkbox" | "boolean" | "date-range"`],
        ]}/>
    </Tab>
</Tabs>

### Client-side

<Preview contentClassName={"max-w-full"}>
    <DataGridClientFilteringExample/>
</Preview>

```tsx showLineNumbers /withFiltering/ /getFilterFn/
import React from "react"
import { createDataGridColumns } from "@/components/ui/datagrid"

export function Demo() {

    const columns = useMemo(() => createDataGridColumns<Product>(({ withValueFormatter, withFiltering, getFilterFn }) => [
        ...
        {
            accessorKey: "category",
            header: "Category",
            cell: info => info.getValue(),
            size: 20,
            filterFn: getFilterFn("radio"),
            meta: {
                ...withFiltering({
                    name: "Category",
                    type: "radio",
                    options: [{ value: "Electronics" }, { value: "Food" }],
                    icon: <BiFolder/>,
                }),
            },
        },
        {
            accessorKey: "availability",
            header: "Availability",
            cell: info => info.getValue(),
            size: 20,
            filterFn: getFilterFn("checkbox"),
            meta: {
                ...withValueFormatter<string>(value => {
                    if (value === "out_of_stock") return "Out of stock"
                    if (value === "in_stock") return "In stock"
                    return value
                }),
                ...withFiltering({
                    name: "Availability",
                    type: "checkbox",
                    icon: <BiCheck/>,
                    options: [
                        {
                            value: "out_of_stock",
                            label: <span className={"flex items-center gap-2"}><BiBasket className={"text-red-500"}/><span>Out of stock</span></span>,
                        },
                        {
                            value: "in_stock",
                            label: <span className={"flex items-center gap-2"}><BiBasket className={"text-green-500"}/><span>In stock</span></span>,
                        },
                    ],
                }),
            },
        },
        {
            accessorKey: "visible",
            header: "Visible",
            cell: info => <Badge intent={info.getValue() === "Visible" ? "success" : "gray"}>{info.getValue<string>()}</Badge>,
            size: 20,
            filterFn: getFilterFn("boolean"),
            meta: {
                ...withValueFormatter<boolean, string>(value => {
                    return value ? "Visible" : "Hidden"
                }),
                ...withFiltering({
                    name: "Visible",
                    type: "boolean",
                    icon: <BiLowVision/>,
                    valueFormatter: (value) => {        // Overrides `withValueFormatter`
                        return value ? "Yes" : "No"
                    },
                }),
            },
        },
        ...
    ]), [])

    return (...)

}
```

### Server-side

When you have a lot of data that needs to be filtered on the server, instead of client-side,
you will want to set the `enableServerSideFiltering` to `true` and manage the server-side model.

```tsx showLineNumbers {9,10,17,18,21}
function Demo() {
    const serverSideModel = useDataGridServerSideModel({
        initialState: {
            rowsPerPage: 5,
        },
    })

    const { data, totalCount, isLoading } = useFakeQuery({
        globalFilter: serverSideModel.filteringModel.globalFilterValue, // eg: "blue"
        filters: serverSideModel.filteringModel.filters // eg: [{ id: "availability", value: "out_of_stock" }]
    })

    const columns = useMemo(() => createDataGridColumns<Product>(() => [...]))

    return (
        <DataGrid<Product>
            serverSideModel={serverSideModel}
            enableServerSideFiltering
            columns={columns}
            data={data}
            rowCount={serverSideModel.isFiltering ? (data?.length ?? 0) : totalCount}
            isLoading={isLoading}
        />
    )

}
```

#### Reference

<PropsTable title="filteringModel" options={[
    ["globalFilterValue", `string`],
    ["filters", `Array<{ id: string, value: unknown }>`, "`id` represents the column key"],
]}/>
